<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kids Art Tales - å„¿ç«¥ç»˜ç”»æ•…äº‹åˆ›ä½œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #FF6B9D;
      --secondary: #C44569;
      --accent: #FFC93C;
      --success: #95E1D3;
      --info: #AA96DA;
      --bg: #FFF5F7;
      --card-bg: #FFFFFF;
      --text: #2C3E50;
      --text-light: #7F8C8D;
      --border: #F8D7DA;
      --shadow: rgba(255, 107, 157, 0.15);
    }

    body {
      font-family: 'Comic Sans MS', 'Microsoft YaHei', 'PingFang SC', sans-serif;
      background: linear-gradient(135deg, #FFF5F7 0%, #FFE5E9 100%);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 80px;
    }

    /* Navigation Bar */
    .navbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card-bg);
      border-top: 3px solid var(--primary);
      box-shadow: 0 -4px 20px var(--shadow);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 1000;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 16px;
      transition: all 0.3s ease;
      color: var(--text-light);
      text-decoration: none;
      font-size: 12px;
    }

    .nav-item.active {
      color: var(--primary);
      background: var(--bg);
      transform: translateY(-4px);
    }

    .nav-item:hover {
      background: var(--bg);
      transform: translateY(-2px);
    }

    .nav-icon {
      font-size: 24px;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header h1 {
      font-size: 24px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .points-badge {
      background: var(--accent);
      color: var(--text);
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .profile-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: white;
      border: 3px solid var(--accent);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* Page Container */
    .page {
      display: none;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .page.active {
      display: block;
    }

    /* Hero Section */
    .hero {
      background: linear-gradient(135deg, var(--info) 0%, var(--success) 100%);
      border-radius: 24px;
      padding: 30px;
      margin-bottom: 24px;
      text-align: center;
      color: white;
      box-shadow: 0 8px 24px var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: 'ğŸ¨';
      position: absolute;
      font-size: 120px;
      opacity: 0.2;
      top: -20px;
      right: -20px;
    }

    .hero h2 {
      font-size: 28px;
      margin-bottom: 12px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .hero p {
      font-size: 16px;
      opacity: 0.95;
    }

    /* Feature Buttons */
    .feature-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .feature-btn {
      background: var(--card-bg);
      border: 3px solid var(--primary);
      border-radius: 20px;
      padding: 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px var(--shadow);
    }

    .feature-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px var(--shadow);
      background: var(--bg);
    }

    .feature-btn .icon {
      font-size: 48px;
      margin-bottom: 12px;
      display: block;
    }

    .feature-btn h3 {
      font-size: 18px;
      color: var(--primary);
      margin-bottom: 8px;
    }

    .feature-btn p {
      font-size: 12px;
      color: var(--text-light);
    }

    /* Works Gallery */
    .works-section {
      margin-top: 32px;
    }

    .section-title {
      font-size: 22px;
      color: var(--primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .category-tabs {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .category-tab {
      padding: 10px 20px;
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: bold;
    }

    .category-tab.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .works-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
    }

    .work-card {
      background: var(--card-bg);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 12px var(--shadow);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .work-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px var(--shadow);
    }

    .work-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      background: linear-gradient(135deg, var(--info) 0%, var(--success) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
    }

    .work-info {
      padding: 12px;
    }

    .work-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 6px;
      color: var(--text);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .work-author {
      font-size: 12px;
      color: var(--text-light);
      margin-bottom: 8px;
    }

    .work-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .work-action-btn {
      flex: 1;
      padding: 6px 12px;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: var(--bg);
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .work-action-btn:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .work-action-btn.liked {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Profile Page */
    .profile-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      border-radius: 24px;
      padding: 30px;
      text-align: center;
      color: white;
      margin-bottom: 24px;
      box-shadow: 0 8px 24px var(--shadow);
    }

    .profile-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: white;
      border: 5px solid var(--accent);
      margin: 0 auto 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .profile-name {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .profile-info {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 16px;
      font-size: 14px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .info-value {
      font-size: 20px;
      font-weight: bold;
    }

    .profile-section {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px var(--shadow);
    }

    .profile-section h3 {
      color: var(--primary);
      margin-bottom: 16px;
      font-size: 18px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text);
      font-weight: bold;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 14px;
      font-family: inherit;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px var(--shadow);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px var(--shadow);
    }

    .creations-list {
      display: grid;
      gap: 12px;
    }

    .creation-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg);
      border-radius: 12px;
      border: 2px solid var(--border);
    }

    .creation-icon {
      font-size: 32px;
    }

    .creation-details {
      flex: 1;
    }

    .creation-title {
      font-weight: bold;
      margin-bottom: 4px;
    }

    .creation-date {
      font-size: 12px;
      color: var(--text-light);
    }

    /* Subscription Page */
    .plans-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .plan-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 8px 24px var(--shadow);
      position: relative;
      transition: all 0.3s ease;
    }

    .plan-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px var(--shadow);
    }

    .plan-card.gold {
      border: 4px solid var(--accent);
      background: linear-gradient(135deg, #FFF9E6 0%, #FFFFFF 100%);
    }

    .plan-badge {
      position: absolute;
      top: -12px;
      right: 20px;
      background: var(--accent);
      color: var(--text);
      padding: 6px 16px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .plan-name {
      font-size: 24px;
      color: var(--primary);
      margin-bottom: 12px;
    }

    .plan-price {
      font-size: 36px;
      font-weight: bold;
      color: var(--secondary);
      margin-bottom: 20px;
    }

    .plan-features {
      list-style: none;
      margin-bottom: 24px;
    }

    .plan-features li {
      padding: 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .plan-features li::before {
      content: 'âœ“';
      color: var(--success);
      font-weight: bold;
      font-size: 18px;
    }

    /* Camera Page */
    .camera-container {
      text-align: center;
      padding: 40px 20px;
    }

    .camera-placeholder {
      width: 100%;
      max-width: 400px;
      height: 400px;
      background: var(--card-bg);
      border: 4px dashed var(--border);
      border-radius: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin: 0 auto 24px;
      font-size: 64px;
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    /* Settings Page */
    .settings-list {
      display: grid;
      gap: 12px;
    }

    .setting-item {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 12px var(--shadow);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .setting-item:hover {
      transform: translateX(4px);
      box-shadow: 0 6px 16px var(--shadow);
    }

    .setting-label {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .setting-icon {
      font-size: 24px;
    }

    .setting-name {
      font-weight: bold;
      color: var(--text);
    }

    .setting-value {
      color: var(--text-light);
      font-size: 14px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 24px;
      color: var(--primary);
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 32px;
      cursor: pointer;
      color: var(--text-light);
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-light);
    }

    .spinner {
      border: 4px solid var(--border);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .feature-buttons {
        grid-template-columns: 1fr;
      }

      .works-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      }

      .plans-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>ğŸ¨ Kids Art Tales</h1>
    <div class="header-actions">
      <div class="points-badge" id="pointsBadge">ğŸ’ 100</div>
      <div class="profile-btn" onclick="showPage('profile')">ğŸ‘¤</div>
    </div>
  </div>

  <!-- Home Page -->
  <div class="page active" id="home">
    <!-- Hero Section -->
    <div class="hero">
      <h2>æ¬¢è¿æ¥åˆ°åˆ›æ„ä¸–ç•Œï¼</h2>
      <p>ä¸Šä¼ ä½ çš„ç”»ä½œï¼Œè®©æˆ‘ä»¬ä¸€èµ·åˆ›é€ ç¥å¥‡çš„æ•…äº‹å§ï¼</p>
    </div>

    <!-- Feature Buttons -->
    <div class="feature-buttons">
      <div class="feature-btn" onclick="openFeatureModal('audio')">
        <span class="icon">ğŸµ</span>
        <h3>Audio Story</h3>
        <p>å›¾ç”Ÿè¯­éŸ³æ•…äº‹</p>
      </div>
      <div class="feature-btn" onclick="openFeatureModal('picture')">
        <span class="icon">ğŸ–¼ï¸</span>
        <h3>Picture Story</h3>
        <p>å›¾ç”Ÿç»˜æœ¬æ•…äº‹</p>
      </div>
      <div class="feature-btn" onclick="openFeatureModal('animation')">
        <span class="icon">ğŸ¬</span>
        <h3>Animation</h3>
        <p>å›¾ç”ŸåŠ¨ç”»è§†é¢‘</p>
      </div>
    </div>

    <!-- Works Gallery -->
    <div class="works-section">
      <h2 class="section-title">
        <span>ğŸŒŸ</span>
        <span>ç¤¾åŒºä½œå“</span>
      </h2>
      <div class="category-tabs">
        <div class="category-tab active" onclick="filterWorks('all')">å…¨éƒ¨</div>
        <div class="category-tab" onclick="filterWorks('audio')">ğŸµ è¯­éŸ³æ•…äº‹</div>
        <div class="category-tab" onclick="filterWorks('picture')">ğŸ–¼ï¸ ç»˜æœ¬æ•…äº‹</div>
        <div class="category-tab" onclick="filterWorks('animation')">ğŸ¬ åŠ¨ç”»è§†é¢‘</div>
      </div>
      <div class="works-grid" id="worksGrid">
        <div class="loading">
          <div class="spinner"></div>
          <p>åŠ è½½ä¸­...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Camera Page -->
  <div class="page" id="camera">
    <div class="camera-container">
      <h2 class="section-title">ğŸ“· ä¸Šä¼ ä½ çš„ç”»ä½œ</h2>
      <div class="camera-placeholder">
        <span>ğŸ“¸</span>
        <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©å›¾ç‰‡</p>
      </div>
      <div class="file-input-wrapper">
        <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)" />
        <button class="btn btn-primary">é€‰æ‹©å›¾ç‰‡</button>
      </div>
      <div id="uploadPreview" style="margin-top: 24px; display: none;">
        <img id="previewImage" style="max-width: 100%; border-radius: 16px; box-shadow: 0 4px 12px var(--shadow);" />
        <div style="margin-top: 16px;">
          <input type="text" id="imagePrompt" placeholder="æè¿°ä½ çš„ç”»ä½œæˆ–æ·»åŠ å…³é”®è¯..." style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 12px; margin-bottom: 12px;" />
          <button class="btn btn-primary" onclick="processImage()">å¼€å§‹åˆ›ä½œ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Page -->
  <div class="page" id="profile">
    <div class="profile-header">
      <div class="profile-avatar" id="profileAvatar">ğŸ‘¤</div>
      <div class="profile-name" id="profileName">å°è‰ºæœ¯å®¶</div>
      <div class="profile-info">
        <div class="info-item">
          <div class="info-value" id="profilePoints">100</div>
          <div>ç§¯åˆ†</div>
        </div>
        <div class="info-item">
          <div class="info-value" id="profileCreations">0</div>
          <div>ä½œå“</div>
        </div>
        <div class="info-item">
          <div class="info-value" id="profileMembership">å…è´¹</div>
          <div>ä¼šå‘˜</div>
        </div>
      </div>
    </div>

    <div class="profile-section">
      <h3>ä¸ªäººä¿¡æ¯</h3>
      <div class="form-group">
        <label>åå­—</label>
        <input type="text" id="profileNameInput" placeholder="è¾“å…¥ä½ çš„åå­—" />
      </div>
      <div class="form-group">
        <label>å¹´é¾„</label>
        <input type="number" id="profileAgeInput" placeholder="è¾“å…¥ä½ çš„å¹´é¾„" min="3" max="12" />
      </div>
      <div class="form-group">
        <label>è¯­è¨€</label>
        <select id="profileLanguageInput">
          <option value="zh">ä¸­æ–‡</option>
          <option value="en">English</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="saveProfile()">ä¿å­˜</button>
    </div>

    <div class="profile-section">
      <h3>æˆ‘çš„ä½œå“</h3>
      <div class="creations-list" id="creationsList">
        <div class="loading">
          <p>åŠ è½½ä¸­...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Page -->
  <div class="page" id="settings">
    <h2 class="section-title">âš™ï¸ è®¾ç½®</h2>
    <div class="settings-list">
      <div class="setting-item" onclick="showPage('subscription')">
        <div class="setting-label">
          <span class="setting-icon">ğŸ’</span>
          <div>
            <div class="setting-name">ä¼šå‘˜è®¢é˜…</div>
            <div class="setting-value">ç®¡ç†ä½ çš„ä¼šå‘˜å’Œç§¯åˆ†</div>
          </div>
        </div>
        <span>â†’</span>
      </div>
      <div class="setting-item" onclick="showPage('profile')">
        <div class="setting-label">
          <span class="setting-icon">ğŸ‘¤</span>
          <div>
            <div class="setting-name">ä¸ªäººèµ„æ–™</div>
            <div class="setting-value">ç¼–è¾‘ä¸ªäººä¿¡æ¯</div>
          </div>
        </div>
        <span>â†’</span>
      </div>
      <div class="setting-item">
        <div class="setting-label">
          <span class="setting-icon">ğŸ””</span>
          <div>
            <div class="setting-name">é€šçŸ¥è®¾ç½®</div>
            <div class="setting-value">ç®¡ç†é€šçŸ¥åå¥½</div>
          </div>
        </div>
        <span>â†’</span>
      </div>
      <div class="setting-item">
        <div class="setting-label">
          <span class="setting-icon">â“</span>
          <div>
            <div class="setting-name">å¸®åŠ©ä¸æ”¯æŒ</div>
            <div class="setting-value">å¸¸è§é—®é¢˜å’Œä½¿ç”¨æŒ‡å—</div>
          </div>
        </div>
        <span>â†’</span>
      </div>
    </div>
  </div>

  <!-- Subscription Page -->
  <div class="page" id="subscription">
    <h2 class="section-title">ğŸ’ ä¼šå‘˜è®¢é˜…</h2>
    <div class="plans-container" id="plansContainer">
      <div class="loading">
        <div class="spinner"></div>
        <p>åŠ è½½ä¸­...</p>
      </div>
    </div>
    <div class="profile-section">
      <h3>ä»Šæ—¥ä½¿ç”¨æƒ…å†µ</h3>
      <div id="usageInfo">
        <div class="loading">
          <p>åŠ è½½ä¸­...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Points Page -->
  <div class="page" id="points">
    <div class="profile-section">
      <h3>æˆ‘çš„ç§¯åˆ†</h3>
      <div style="text-align: center; padding: 40px;">
        <div style="font-size: 64px; margin-bottom: 16px;">ğŸ’</div>
        <div style="font-size: 48px; font-weight: bold; color: var(--primary); margin-bottom: 8px;" id="currentPoints">100</div>
        <div style="color: var(--text-light); margin-bottom: 24px;">å½“å‰ç§¯åˆ†</div>
        <button class="btn btn-primary" onclick="showPage('subscription')">è´­ä¹°ç§¯åˆ†</button>
      </div>
    </div>
    <div class="profile-section">
      <h3>ç§¯åˆ†è¯´æ˜</h3>
      <ul style="list-style: none; padding: 0;">
        <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
          <span>âœ“</span>
          <span>ä½œå“è¢«ç‚¹èµå¯è·å¾—1ç§¯åˆ†</span>
        </li>
        <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
          <span>âœ“</span>
          <span>ç§¯åˆ†å¯ç”¨äºè´­ä¹°é¢å¤–åŠŸèƒ½</span>
        </li>
        <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
          <span>âœ“</span>
          <span>æ¯æ—¥å…è´¹é¢åº¦ç”¨å®Œåå¯ä½¿ç”¨ç§¯åˆ†</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Navigation Bar -->
  <div class="navbar">
    <a class="nav-item active" onclick="showPage('home')">
      <span class="nav-icon">ğŸ </span>
      <span>ä¸»é¡µ</span>
    </a>
    <a class="nav-item" onclick="showPage('camera')">
      <span class="nav-icon">ğŸ“·</span>
      <span>æ‹ç…§</span>
    </a>
    <a class="nav-item" onclick="showPage('profile')">
      <span class="nav-icon">ğŸ‘¤</span>
      <span>ä¸ªäºº</span>
    </a>
    <a class="nav-item" onclick="showPage('settings')">
      <span class="nav-icon">âš™ï¸</span>
      <span>è®¾ç½®</span>
    </a>
    <a class="nav-item" onclick="showPage('points')">
      <span class="nav-icon">ğŸ’</span>
      <span>ç§¯åˆ†</span>
    </a>
  </div>

  <!-- Feature Modal -->
  <div class="modal" id="featureModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">åˆ›ä½œ</h3>
        <button class="close-btn" onclick="closeModal()">&times;</button>
      </div>
      <div id="modalBody">
        <p>è¯·å…ˆä¸Šä¼ å›¾ç‰‡</p>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = '';
    let currentUserId = localStorage.getItem('userId') || '';
    let currentUser = null;
    let currentWorksFilter = 'all';
    let currentApiKey = localStorage.getItem('apiKey') || '';

    // Initialize
    async function init() {
      // æ£€æŸ¥æ˜¯å¦æœ‰ API key
      if (!currentApiKey) {
        // å°è¯•ä½¿ç”¨é»˜è®¤çš„ dev key
        currentApiKey = 'dev-key-12345';
        localStorage.setItem('apiKey', currentApiKey);
      }
      
      if (!currentUserId) {
        await createUser();
      } else {
        await loadUser();
      }
      await loadWorks();
      await loadSubscriptionPlans();
      await loadUsage();
    }

    // è·å–è¯·æ±‚å¤´ï¼ˆåŒ…å« API keyï¼‰
    function getHeaders(contentType = 'application/json') {
      const headers = {
        'Content-Type': contentType,
      };
      if (currentApiKey) {
        headers['X-API-Key'] = currentApiKey;
      }
      return headers;
    }

    // åŒ…è£… fetch å‡½æ•°ï¼Œè‡ªåŠ¨æ·»åŠ  API key
    async function apiFetch(url, options = {}) {
      const headers = getHeaders(options.headers?.['Content-Type'] || 'application/json');
      if (options.headers) {
        Object.assign(headers, options.headers);
      }
      return fetch(url, {
        ...options,
        headers,
      });
    }

    // User Management
    async function createUser() {
      try {
        const res = await fetch(`${API_BASE}/api/users`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ name: 'å°è‰ºæœ¯å®¶', language: 'zh' })
        });
        const user = await res.json();
        currentUserId = user.id;
        currentUser = user;
        localStorage.setItem('userId', currentUserId);
        updateUI();
      } catch (error) {
        console.error('Failed to create user:', error);
      }
    }

    async function loadUser() {
      try {
        const res = await fetch(`${API_BASE}/api/users/${currentUserId}`);
        currentUser = await res.json();
        updateUI();
      } catch (error) {
        console.error('Failed to load user:', error);
        await createUser();
      }
    }

    async function saveProfile() {
      try {
        const name = document.getElementById('profileNameInput').value;
        const age = document.getElementById('profileAgeInput').value;
        const language = document.getElementById('profileLanguageInput').value;
        
        const res = await fetch(`${API_BASE}/api/users/${currentUserId}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, age: age ? parseInt(age) : undefined, language })
        });
        currentUser = await res.json();
        updateUI();
        alert('ä¿å­˜æˆåŠŸï¼');
      } catch (error) {
        console.error('Failed to save profile:', error);
        alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }

    function updateUI() {
      if (!currentUser) return;
      
      // Update header
      document.getElementById('pointsBadge').textContent = `ğŸ’ ${currentUser.points || 0}`;
      document.getElementById('currentPoints').textContent = currentUser.points || 0;
      
      // Update profile
      document.getElementById('profileName').textContent = currentUser.name || 'å°è‰ºæœ¯å®¶';
      document.getElementById('profileNameInput').value = currentUser.name || '';
      document.getElementById('profileAgeInput').value = currentUser.age || '';
      document.getElementById('profileLanguageInput').value = currentUser.language || 'zh';
      document.getElementById('profilePoints').textContent = currentUser.points || 0;
      document.getElementById('profileCreations').textContent = currentUser.creations?.length || 0;
      document.getElementById('profileMembership').textContent = currentUser.membership === 'gold' ? 'é»„é‡‘' : 'å…è´¹';
      
      // Load creations
      loadCreations();
    }

    async function loadCreations() {
      try {
        const res = await fetch(`${API_BASE}/api/users/${currentUserId}/creations`);
        const data = await res.json();
        const list = document.getElementById('creationsList');
        if (data.creations && data.creations.length > 0) {
          list.innerHTML = data.creations.map(creation => `
            <div class="creation-item">
              <div class="creation-icon">${getCreationIcon(creation.type)}</div>
              <div class="creation-details">
                <div class="creation-title">${creation.title}</div>
                <div class="creation-date">${new Date(creation.createdAt).toLocaleDateString()}</div>
              </div>
            </div>
          `).join('');
        } else {
          list.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 20px;">è¿˜æ²¡æœ‰ä½œå“ï¼Œå¿«å»åˆ›ä½œå§ï¼</p>';
        }
      } catch (error) {
        console.error('Failed to load creations:', error);
      }
    }

    function getCreationIcon(type) {
      const icons = {
        'audio': 'ğŸµ',
        'picture': 'ğŸ–¼ï¸',
        'animation': 'ğŸ¬',
        'picture-book': 'ğŸ“š'
      };
      return icons[type] || 'ğŸ¨';
    }

    // Works Management
    async function loadWorks(filter = 'all') {
      try {
        const url = filter === 'all' 
          ? `${API_BASE}/api/community/works`
          : `${API_BASE}/api/community/works?type=${filter}`;
        const res = await fetch(url);
        const works = await res.json();
        displayWorks(works);
      } catch (error) {
        console.error('Failed to load works:', error);
        document.getElementById('worksGrid').innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 20px;">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p>';
      }
    }

    function displayWorks(works) {
      const grid = document.getElementById('worksGrid');
      if (!works || works.length === 0) {
        grid.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 20px; grid-column: 1 / -1;">è¿˜æ²¡æœ‰ä½œå“ï¼Œæˆä¸ºç¬¬ä¸€ä¸ªåˆ›ä½œè€…å§ï¼</p>';
        return;
      }
      
      grid.innerHTML = works.map(work => `
        <div class="work-card">
          <div class="work-image">${getWorkIcon(work.type)}</div>
          <div class="work-info">
            <div class="work-title">${work.title}</div>
            <div class="work-author">by ${work.authorName || 'åŒ¿å'}</div>
            <div class="work-actions">
              <button class="work-action-btn" onclick="likeWork('${work.id}')">
                <span>â¤ï¸</span>
                <span>${work.likeCount || 0}</span>
              </button>
              <button class="work-action-btn" onclick="shareWork('${work.id}')">
                <span>åˆ†äº«</span>
              </button>
              <button class="work-action-btn" onclick="coCreateWork('${work.id}')">
                <span>ä¸€èµ·åˆ›ä½œ</span>
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function getWorkIcon(type) {
      const icons = {
        'audio': 'ğŸµ',
        'picture': 'ğŸ–¼ï¸',
        'animation': 'ğŸ¬'
      };
      return icons[type] || 'ğŸ¨';
    }

    function filterWorks(type) {
      currentWorksFilter = type;
      document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      loadWorks(type);
    }

    async function likeWork(workId) {
      try {
        const res = await fetch(`${API_BASE}/api/community/works/${workId}/like`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userId: currentUserId })
        });
        const data = await res.json();
        if (data.authorReward) {
          // Notify author about reward
          await fetch(`${API_BASE}/api/users/${data.authorId}/points/add-like-reward`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ amount: data.authorReward })
          });
        }
        loadWorks(currentWorksFilter);
        if (currentUser) {
          await loadUser();
        }
      } catch (error) {
        console.error('Failed to like work:', error);
      }
    }

    async function shareWork(workId) {
      try {
        await fetch(`${API_BASE}/api/community/works/${workId}/share`, {
          method: 'POST'
        });
        alert('åˆ†äº«æˆåŠŸï¼');
      } catch (error) {
        console.error('Failed to share work:', error);
      }
    }

    async function coCreateWork(workId) {
      alert('ååŒåˆ›ä½œåŠŸèƒ½å¼€å‘ä¸­...');
    }

    // Image Upload
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          document.getElementById('previewImage').src = e.target.result;
          document.getElementById('uploadPreview').style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    }

    async function processImage() {
      const file = document.getElementById('imageUpload').files[0];
      const prompt = document.getElementById('imagePrompt').value;
      
      if (!file) {
        alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
        return;
      }
      
      alert('å›¾ç‰‡å¤„ç†åŠŸèƒ½å¼€å‘ä¸­...');
    }

    // Subscription
    async function loadSubscriptionPlans() {
      try {
        const res = await fetch(`${API_BASE}/api/subscriptions/plans`);
        const plans = await res.json();
        displayPlans(plans);
      } catch (error) {
        console.error('Failed to load plans:', error);
      }
    }

    function displayPlans(plans) {
      const container = document.getElementById('plansContainer');
      container.innerHTML = `
        <div class="plan-card">
          <div class="plan-name">${plans.free.name}</div>
          <div class="plan-price">å…è´¹</div>
          <ul class="plan-features">
            ${plans.free.perks.map(perk => `<li>${perk}</li>`).join('')}
          </ul>
          <button class="btn btn-primary" style="width: 100%;" onclick="upgradeMembership('free')">
            ${currentUser?.membership === 'free' ? 'å½“å‰å¥—é¤' : 'é€‰æ‹©å…è´¹ç‰ˆ'}
          </button>
        </div>
        <div class="plan-card gold">
          <div class="plan-badge">æ¨è</div>
          <div class="plan-name">${plans.gold.name}</div>
          <div class="plan-price">Â¥29/æœˆ</div>
          <ul class="plan-features">
            ${plans.gold.perks.map(perk => `<li>${perk}</li>`).join('')}
          </ul>
          <button class="btn btn-primary" style="width: 100%; background: var(--accent);" onclick="upgradeMembership('gold')">
            ${currentUser?.membership === 'gold' ? 'å½“å‰å¥—é¤' : 'å‡çº§åˆ°é»„é‡‘ç‰ˆ'}
          </button>
        </div>
      `;
    }

    async function upgradeMembership(level) {
      try {
        const res = await fetch(`${API_BASE}/api/users/${currentUserId}/membership`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ level })
        });
        currentUser = await res.json();
        updateUI();
        await loadSubscriptionPlans();
        alert('ä¼šå‘˜æ›´æ–°æˆåŠŸï¼');
      } catch (error) {
        console.error('Failed to upgrade membership:', error);
        alert('æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }

    async function loadUsage() {
      if (!currentUserId) return;
      try {
        const res = await fetch(`${API_BASE}/api/subscriptions/${currentUserId}/usage`);
        const usage = await res.json();
        displayUsage(usage);
      } catch (error) {
        console.error('Failed to load usage:', error);
      }
    }

    function displayUsage(usage) {
      const container = document.getElementById('usageInfo');
      const membership = currentUser?.membership || 'free';
      const limits = {
        free: { audioStories: 1, pictureBooks: 1, animations: 1 },
        gold: { audioStories: 'æ— é™', pictureBooks: 1, animations: 5 }
      };
      const limit = limits[membership];
      
      container.innerHTML = `
        <div style="display: grid; gap: 12px;">
          <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--bg); border-radius: 12px;">
            <span>ğŸµ è¯­éŸ³æ•…äº‹</span>
            <span><strong>${usage.audioStories || 0}</strong> / ${limit.audioStories}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--bg); border-radius: 12px;">
            <span>ğŸ“š ç»˜æœ¬æ•…äº‹</span>
            <span><strong>${usage.pictureBooks || 0}</strong> / ${limit.pictureBooks}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--bg); border-radius: 12px;">
            <span>ğŸ¬ åŠ¨ç”»è§†é¢‘</span>
            <span><strong>${usage.animations || 0}</strong> / ${limit.animations}</span>
          </div>
        </div>
      `;
    }

    // Navigation
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      event?.target?.closest('.nav-item')?.classList.add('active');
      
      if (pageId === 'subscription') {
        loadSubscriptionPlans();
        loadUsage();
      } else if (pageId === 'profile') {
        loadCreations();
      }
    }

    // Modal
    function openFeatureModal(type) {
      const modal = document.getElementById('featureModal');
      const title = document.getElementById('modalTitle');
      const body = document.getElementById('modalBody');
      
      const titles = {
        'audio': 'ğŸµ åˆ›å»ºè¯­éŸ³æ•…äº‹',
        'picture': 'ğŸ–¼ï¸ åˆ›å»ºç»˜æœ¬æ•…äº‹',
        'animation': 'ğŸ¬ åˆ›å»ºåŠ¨ç”»è§†é¢‘'
      };
      
      title.textContent = titles[type] || 'åˆ›ä½œ';
      body.innerHTML = `
        <p>è¯·å…ˆåˆ°"æ‹ç…§"é¡µé¢ä¸Šä¼ ä½ çš„ç”»ä½œï¼Œç„¶åé€‰æ‹©åˆ›ä½œç±»å‹ã€‚</p>
        <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="showPage('camera'); closeModal();">
          å»ä¸Šä¼ å›¾ç‰‡
        </button>
      `;
      modal.classList.add('active');
    }

    function closeModal() {
      document.getElementById('featureModal').classList.remove('active');
    }

    // Initialize on load
    init();
  </script>
</body>
</html>

